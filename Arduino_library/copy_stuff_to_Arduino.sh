#!/usr/bin/env bash

# Improved script to copy only relevant files for the Arduino library
# Fixes TODO item #7: "Make sure that the copy_stuff_to_Arduino.sh script copies all relevant file for the Arduino library to work"

DEST_DIR="/Users/tom/Documents/Arduino/libraries/Servomotor"

# Ensure destination directory exists
if [ ! -d "$DEST_DIR" ]; then
    echo "Creating destination directory: $DEST_DIR"
    mkdir -p "$DEST_DIR"
fi

# Clean destination directory (optional)
echo "Cleaning destination directory..."
rm -rf "$DEST_DIR"/*

# Define core files that need to be copied
CORE_FILES=(
    "Servomotor.cpp"
    "Servomotor.h"
    "Commands.h"
    "Communication.cpp"
    "Communication.h"
    "DataTypes.cpp"
    "DataTypes.h"
    "Utils.cpp"
    "Utils.h"
    "AutoGeneratedUnitConversions.cpp"
    "AutoGeneratedUnitConversions.h"
    "library.properties"
    "README.md"
)

# Create standard Arduino library directories
mkdir -p "$DEST_DIR/src"

# Copy each file and report
echo "Copying library files to $DEST_DIR/src:"
for FILE in "${CORE_FILES[@]}"; do
    if [ -f "$FILE" ]; then
        cp "$FILE" "$DEST_DIR/src"
        # Also copy header files to root dir for compatibility
        if [[ "$FILE" == *.h ]]; then
            cp "$FILE" "$DEST_DIR"
            echo "  ✅ $FILE (copied to both src/ and root)"
        else
            echo "  ✅ $FILE (copied to src/)"
        fi
    else
        echo "  ❌ Warning: $FILE not found!"
    fi
done
mkdir -p "$DEST_DIR/examples"

# Define examples to be included
EXAMPLES=(
    "example_one_move.cpp:One_Move"
    "example_one_move_two_motors.cpp:One_Move_Two_Motors"
)

echo "Creating examples:"
for EXAMPLE in "${EXAMPLES[@]}"; do
    SRC="${EXAMPLE%%:*}"
    DIR="${EXAMPLE##*:}"
    
    if [ -f "$SRC" ]; then
        # Create example directory
        mkdir -p "$DEST_DIR/examples/$DIR"
        
        # Copy and rename the test file to match directory name
        cp "$SRC" "$DEST_DIR/examples/$DIR/$DIR.ino"
        echo "  ✅ Created example: $DIR from $SRC"
    else
        echo "  ❌ Warning: Example source $SRC not found!"
    fi
done

echo "Done! Library copied to $DEST_DIR"
