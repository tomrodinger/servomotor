# Project Overview

This project provides a C++ library for controlling servo motors on both embedded platforms (Arduino, ESP32-C3, etc.) and desktop environments (macOS, etc.). It includes:

- **Minimal Arduino emulator** for desktop testing (`ArduinoEmulator.h`).
- **Auto-generated unit conversions** for positions, velocities, times, temperatures, etc. (`AutoGeneratedUnitConversions.*`).
- **Motor classes** (`Motor.*` and `ServomotorCommands.*`) that handle simpler moves or more advanced operations.
- **Single “Servomotor.h”** aggregator header that pulls everything together for the end user.
- **Example test programs**: `test_one_move.cpp`, `test_motor.cpp`, and `test_unit_conversions.cpp`.

## Autogeneration of Parts of the Source Code

The library includes several Python scripts for code generation and maintenance:

- `generate_unit_conversion_code.py`: Generates unit conversion code from a JSON configuration
- `generate_command_code.py`: Generates command interface code

## File List and Descriptions

Below is an updated overview of the key files after renaming and restructuring:

| File                              | Description                                                                                                    |
|-----------------------------------|----------------------------------------------------------------------------------------------------------------|
| **ArduinoEmulator.h**             | Emulates Arduino’s `Serial`, `delay()`, etc. for desktop builds.                                               |
| **AutoGeneratedUnitConversions.h / .cpp** | Functions to convert between various units (time, position, velocity, acceleration, etc.).                  |
| **Commands.h**                    | Autogenerated list of servo command IDs.                                                                       |
| **Communication.h / .cpp**        | Simple `Communication` class for sending/receiving commands (stubbed for testing).                             |
| **DataTypes.h / .cpp**            | Definitions of data type structures and bounds.                                                                |
| **Utils.h / .cpp**                | Helper utilities for endianness, packing, and general-purpose functionality.                                   |
| **Motor.h / .cpp**                | A simpler, user-friendly `Motor` class demonstrating unit conversions and trapezoid moves.                     |
| **ServomotorCommands.h / .cpp**   | More advanced command-oriented class (formerly `ServoMotor.*`), allowing calibration, homing, e-stop, etc.     |
| **Servomotor.h**                  | A single “aggregator” header that conditionally includes `<Arduino.h>` or `ArduinoEmulator.h>`, plus the other essential headers (`Motor.h`, `ServomotorCommands.h`, etc.). Users only need to `#include "Servomotor.h"`. |
| **test_one_move.cpp**             | Minimal example demonstrating a single trapezoid move (2 rotations over 3 seconds).                            |
| **test_motor.cpp**                | Desktop test verifying `Motor` class usage.                                                                    |
| **test_unit_conversions.cpp**     | Desktop test verifying unit-conversion logic in `AutoGeneratedUnitConversions.*`.                              |

## Architecture

1. **Single Entry Point**  
   - **`Servomotor.h`** is the file the end user includes in their Arduino sketch or desktop application. It automatically includes either `<Arduino.h>` (for real hardware) or `ArduinoEmulator.h` (for desktop tests), plus the relevant classes (`Motor`, `ServomotorCommands`, etc.).

2. **Unit Conversion Module**  
   - Centralizes all unit transformations in `AutoGeneratedUnitConversions.*`, ensuring consistency. These can be regenerated or updated when conversion factors change.

3. **Communication Module**  
   - `Communication.cpp` is a lightweight stub for sending commands and reading responses. It can be extended or replaced with a hardware-specific protocol (RS-485, UART, etc.).

4. **Motor/Servo Classes**  
   - **`Motor`**: A simpler class focusing on straightforward operations using user-friendly units.  
   - **`ServomotorCommands`**: More advanced methods like enabling/disabling MOSFETs, homing, calibration, etc. (originally named `ServoMotor.*`).

5. **Testing on Desktop vs. Arduino**  
   - If `ARDUINO` macros are defined, `<Arduino.h>` is used for real hardware.  
   - Otherwise, `ArduinoEmulator.h` provides stubs for Serial/delay so the same code builds on desktop.  
   - **Test programs** (`test_one_move.cpp`, `test_motor.cpp`, `test_unit_conversions.cpp`) can be built via a standard C++ compiler on desktop or compiled as `.ino`/C++ sources on an Arduino platform.

## Installation

1. Download the Arduino library
2. Import it into the Arduino IDE
3. Include the library in your project by including "Servomotor.h"

## Example Usage

A typical Arduino `.ino` or `.cpp` file might look like:

```cpp
#include "Servomotor.h"  // Single aggregator include

void setup() {
  Serial.begin(115200);

  // Example using the simpler Motor class
  Motor motor;
  motor.setPositionUnit(PositionUnit::SHAFT_ROTATIONS);
  motor.setTimeUnit(TimeUnit::SECONDS);
  motor.trapezoidMove(2.0f, 3.0f);
}

void loop() {
  // ...
}
```

### Testing

The library includes an Arduino emulator (`ArduinoEmulator.h` and `ArduinoEmulator.cpp`) that allows testing on desktop machines without actual hardware. Test files include:
- `test_motor.cpp`: Tests basic motor functionality
- `test_unit_conversions.cpp`: Validates unit conversion accuracy
- `test_one_move.cpp`: Causes the emulated or real motor to spin for a short time at a reasonble speed

## License

This library is released under the MIT License. See the LICENSE file for details.

## Author

Tom Rodinger (tom.rodinger@alumni.utoronto.ca)
